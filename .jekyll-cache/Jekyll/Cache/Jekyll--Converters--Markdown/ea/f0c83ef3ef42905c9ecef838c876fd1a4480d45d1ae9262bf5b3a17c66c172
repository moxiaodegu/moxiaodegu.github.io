I"­k<blockquote>
<p>
Angular ä¸­çš„å˜åŒ–æ£€æµ‹æœºåˆ¶æ˜¯å½“ component çŠ¶æ€æœ‰å˜åŒ–çš„æ—¶å€™ï¼ŒAngular éƒ½èƒ½æ£€æµ‹åˆ°è¿™äº›å˜åŒ–ï¼Œå¹¶ä¸”èƒ½å¤Ÿå°†è¿™äº›å˜åŒ–ååº”åˆ°é¡µé¢ä¸Šã€‚
</p>
</blockquote>

<p>æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ª componentï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">template</span><span class="p">:</span><span class="s2">`&lt;h1&gt;I am &lt;span [textContent]="data.name"&gt;&lt;/span&gt;&lt;h1&gt;`</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CDParentComponent</span> <span class="p">{</span>
  <span class="nl">data</span> <span class="p">:</span> <span class="kr">any</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">meii</span><span class="dl">'</span><span class="p">,</span> <span class="na">address</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ShangHai</span><span class="dl">'</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å½“æŠŠ cdParentComponent ä¸­<code class="language-plaintext highlighter-rouge">data.name</code>çš„å€¼æ”¹æˆ limeiiï¼Œé¡µé¢ä¼šç›´æ¥æŠŠ meii æ›´æ–°æˆ limeiiï¼Œçœ‹ä¼¼å¾ˆç®€å•çš„ä¸€ä¸ªæ”¹åŠ¨ï¼Œå…¶å®åœ¨ Angular å†…éƒ¨æ¶‰åŠåˆ°å¾ˆå¤šå¤æ‚çš„æ“ä½œï¼ŒåŒ…æ‹¬<code class="language-plaintext highlighter-rouge">å˜åŒ–æ£€æµ‹</code> <code class="language-plaintext highlighter-rouge">è„æ•°æ®æ£€æŸ¥</code> <code class="language-plaintext highlighter-rouge">æ•°æ®ç»‘å®š</code> <code class="language-plaintext highlighter-rouge">å•å‘æ•°æ®æµ</code> <code class="language-plaintext highlighter-rouge">æ›´æ–°DOM</code> <code class="language-plaintext highlighter-rouge">NgZone</code>ç­‰ç­‰ã€‚</p>

<p>å•å‘æ•°æ®æµåœ¨è¿™ç¯‡ã€<a href="https://limeii.github.io/2019/06/angular-unidirectional-data-flow/">Angularï¼šå•å‘æ•°æ®æµ</a>ã€‘æ–‡ç« æœ‰è¯¦ç»†ä»‹ç»ï¼Œä¹Ÿæåˆ° Angular åº”ç”¨å…¶å®å°±æ˜¯ç»„ä»¶æ ‘ï¼Œå˜åŒ–æ£€æµ‹éƒ½æ˜¯æ²¿ç€ç»„ä»¶æ ‘ä» root component å¼€å§‹è‡³ä¸Šè€Œä¸‹æ‰§è¡Œçš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨Angular é‡Œï¼Œæ¯ä¸ª component éƒ½æœ‰ä¸€ä¸ª html æ¨¡æ¿ï¼Œåœ¨ Angular å†…éƒ¨ï¼Œç¼–è¯‘å™¨åœ¨ component å’Œæ¨¡æ¿ä¹‹é—´ä¼šç”Ÿæˆä¸€ä¸ª component viewã€‚æ•°æ®ç»‘å®šã€è„æ•°æ®æ£€æŸ¥å’Œæ›´æ–° DOM éƒ½æ˜¯ç”±è¿™ä¸ª component view å®ç°çš„ã€‚å˜åŒ–æ£€æµ‹æœºåˆ¶ä¹Ÿå¯ä»¥è¯´å°±æ˜¯æ²¿ç€ component view çš„æ ‘çŠ¶ç»“æ„ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„ã€‚</p>

<h2 id="component-view-åˆ°åº•æ˜¯ä»€ä¹ˆ">Component View åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>

<p>æŠŠ<code class="language-plaintext highlighter-rouge">data.name</code>å€¼æ”¹æˆ limeiiï¼Œä¼šè§¦å‘å˜åŒ–æ£€æµ‹ï¼ŒåŒæ—¶ Angular ä¼šåšæ•°æ®è„æ£€æŸ¥ï¼Œä¹Ÿå°±æ˜¯å¯¹æ¯”å½“å‰å€¼ï¼ˆlimeiiï¼‰å’Œä¹‹å‰çš„å€¼ï¼ˆoldvalueï¼šmeiiï¼‰æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœå‘ç°ä¸¤è€…ä¸ä¸€è‡´ï¼Œä¼šæŠŠå½“å‰çš„å€¼ï¼ˆlimeiiï¼‰æ›´æ–°åˆ°é¡µé¢ä¸Šã€‚åŒæ—¶ä¹Ÿä¼šæŠŠå½“å‰çš„å€¼ä¿æŒä¸º oldvalueã€‚</p>

<p>åœ¨æ–‡ç« ã€<a href="https://limeii.github.io/2019/08/angular-compiler/">Angularï¼šæ·±å…¥ç†è§£Angularç¼–è¯‘æœºåˆ¶</a>ã€‘ä¸­ä»‹ç»äº† AoT å’Œ ngcï¼Œæåˆ°è¿‡ ngc ä¼šç”Ÿæˆ<code class="language-plaintext highlighter-rouge">*.ngfactory.js</code>ï¼Œå…¶å® ngfactory å°±æ˜¯ Component Viewã€‚åœ¨<code class="language-plaintext highlighter-rouge">*.ngfactory.js</code>è¿‡ç¨‹ä¸­ï¼Œngc ä¼šæŠŠæ‰€æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„<code class="language-plaintext highlighter-rouge">DOM Nodes/Elements</code>éƒ½æ‰¾å‡ºæ¥ï¼Œç„¶åç»™è¿™äº›<code class="language-plaintext highlighter-rouge">DOM Nodes/Elements</code>ç”Ÿæˆ<code class="language-plaintext highlighter-rouge">Bindings</code>ï¼Œè¿™äº›<code class="language-plaintext highlighter-rouge">Bindings</code>é‡Œä¼šè®°å½•<code class="language-plaintext highlighter-rouge">Element Name/Expression/OldValue</code>ï¼Œä¸€æ—¦æœ‰å¼‚æ­¥äº‹ä»¶å‘ç”Ÿï¼ˆClickäº‹ä»¶æˆ–è€…æ˜¯HttpRequestï¼‰å°±ä¼šè¢«<code class="language-plaintext highlighter-rouge">ngZone</code>æ•è·åˆ°ï¼Œç„¶åè§¦å‘<code class="language-plaintext highlighter-rouge">Change Detection</code>ï¼Œä¹Ÿå°±æ˜¯ä¼šä»<code class="language-plaintext highlighter-rouge">Root Component</code>å¼€å§‹ï¼Œä»ä¸Šåˆ°ä¸‹æ£€æŸ¥æ‰€æœ‰ç»„ä»¶çš„<code class="language-plaintext highlighter-rouge">Bindings</code>ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„<code class="language-plaintext highlighter-rouge">Component View</code>ï¼Œå¯¹æ¯”<code class="language-plaintext highlighter-rouge">NewVaule</code>å’Œ<code class="language-plaintext highlighter-rouge">OldValue</code>ï¼Œå¦‚æœä¸ä¸€è‡´å°±ä¼šæŠŠæ–°å€¼æ›´æ–°åˆ°é¡µé¢ï¼ŒåŒæ—¶æŠŠæ–°å€¼æ›´æ–°ä¸ºæ—§å€¼ï¼ˆè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸æåˆ°çš„è„æ£€æŸ¥æœºåˆ¶<code class="language-plaintext highlighter-rouge">Dirty Checking</code>ï¼‰ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ CDParentComponent é€šè¿‡ ngc ç¼–è¯‘ä»¥åçš„ cd-parent.component.ngfactory.js æ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @fileoverview This file was generated by the Angular template compiler. Do not edit.
 *
 * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}
 * tslint:disable
 */</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">i0</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@angular/core</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">i1</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../cd-child/cd-child.component.ngfactory</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">i2</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../cd-child/cd-child.component</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">i3</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./cd-parent.component</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">styles_CDParentComponent</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">RenderType_CDParentComponent</span> <span class="o">=</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµcrt</span><span class="p">({</span> <span class="na">encapsulation</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">styles</span><span class="p">:</span> <span class="nx">styles_CDParentComponent</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="p">{}</span> <span class="p">});</span>
<span class="k">export</span> <span class="p">{</span> <span class="nx">RenderType_CDParentComponent</span> <span class="k">as</span> <span class="nx">RenderType_CDParentComponent</span> <span class="p">};</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">View_CDParentComponent_0</span><span class="p">(</span><span class="nx">_l</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµvid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">[(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµeld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">)),</span> <span class="p">(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµted</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">I am </span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2"> and I live in </span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">])),</span>

        <span class="p">(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµeld</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">cd-child</span><span class="dl">"</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">i1</span><span class="p">.</span><span class="nx">View_CDChildComponent_0</span><span class="p">,</span> <span class="nx">i1</span><span class="p">.</span><span class="nx">RenderType_CDChildComponent</span><span class="p">)),</span>
        <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµdid</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">638976</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i2</span><span class="p">.</span><span class="nx">CDChildComponent</span><span class="p">,</span> <span class="p">[</span><span class="nx">i0</span><span class="p">.</span><span class="nx">ChangeDetectorRef</span><span class="p">,</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">ApplicationRef</span><span class="p">],</span> <span class="p">{</span> <span class="na">data</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">]</span> <span class="p">},</span> <span class="kc">null</span><span class="p">),</span>

        <span class="p">(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµeld</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[[</span><span class="kc">null</span><span class="p">,</span> <span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">]],</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">_v</span><span class="p">,</span> <span class="nx">en</span><span class="p">,</span> <span class="nx">$event</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">ad</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="kd">var</span> <span class="nx">_co</span> <span class="o">=</span> <span class="nx">_v</span><span class="p">.</span><span class="nx">component</span><span class="p">;</span> <span class="k">if</span> <span class="p">((</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span> <span class="o">===</span> <span class="nx">en</span><span class="p">))</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">pd_0</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_co</span><span class="p">.</span><span class="nx">changeInfo</span><span class="p">()</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">);</span>
                    <span class="nx">ad</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pd_0</span> <span class="o">&amp;&amp;</span> <span class="nx">ad</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">return</span> <span class="nx">ad</span><span class="p">;</span>
            <span class="p">},</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">))</span>

            <span class="p">,</span> <span class="p">(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµted</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">Change Info</span><span class="dl">"</span><span class="p">]))</span>
        <span class="p">],</span>
        
        <span class="kd">function</span> <span class="p">(</span><span class="nx">_ck</span><span class="p">,</span> <span class="nx">_v</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_co</span> <span class="o">=</span> <span class="nx">_v</span><span class="p">.</span><span class="nx">component</span><span class="p">;</span> <span class="kd">var</span> <span class="nx">currVal_2</span> <span class="o">=</span> <span class="nx">_co</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span> <span class="nx">_ck</span><span class="p">(</span><span class="nx">_v</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">currVal_2</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="kd">function</span> <span class="p">(</span><span class="nx">_ck</span><span class="p">,</span> <span class="nx">_v</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">_co</span> <span class="o">=</span> <span class="nx">_v</span><span class="p">.</span><span class="nx">component</span><span class="p">;</span> <span class="kd">var</span> <span class="nx">currVal_0</span> <span class="o">=</span> <span class="nx">_co</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">currVal_1</span> <span class="o">=</span> <span class="nx">_co</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span> <span class="nx">_ck</span><span class="p">(</span><span class="nx">_v</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">currVal_0</span><span class="p">,</span> <span class="nx">currVal_1</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>


<span class="k">export</span> <span class="kd">function</span> <span class="nx">View_CDParentComponent_Host_0</span><span class="p">(</span><span class="nx">_l</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµvid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[(</span><span class="nx">_l</span><span class="p">()(),</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµeld</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ng-component</span><span class="dl">"</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">View_CDParentComponent_0</span><span class="p">,</span> <span class="nx">RenderType_CDParentComponent</span><span class="p">)),</span>
    <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµdid</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">49152</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i3</span><span class="p">.</span><span class="nx">CDParentComponent</span><span class="p">,</span> <span class="p">[],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">)],</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>


<span class="kd">var</span> <span class="nx">CDParentComponentNgFactory</span> <span class="o">=</span> <span class="nx">i0</span><span class="p">.</span><span class="nx">Éµccf</span><span class="p">(</span><span class="dl">"</span><span class="s2">ng-component</span><span class="dl">"</span><span class="p">,</span> <span class="nx">i3</span><span class="p">.</span><span class="nx">CDParentComponent</span><span class="p">,</span> <span class="nx">View_CDParentComponent_Host_0</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">[]);</span>
<span class="k">export</span> <span class="p">{</span> <span class="nx">CDParentComponentNgFactory</span> <span class="k">as</span> <span class="nx">CDParentComponentNgFactory</span> <span class="p">};</span>
<span class="c1">//# sourceMappingURL=cd-parent.component.ngfactory.js.map</span>
</code></pre></div></div>
<p>å„æ®µä»£ç çš„ä½œç”¨å¦‚ä¸‹ï¼š
<img src="/assets/images/posts/angular/angular-change-detection06.png" alt="angular-change-detection" height="100%" width="100%" /></p>

<ul>
  <li>
    <p>View_CDParentComponent_0(<strong>internal component</strong>)ï¼šæ˜¯ CDParentComponentï¼Œé‡Œé¢æœ‰æ¯ä¸ª DOM èŠ‚ç‚¹å¼•ç”¨ï¼Œå¹¶ä¸”ç»™æ¯ä¸ªèŠ‚ç‚¹åšæ•°æ®ç»‘å®šï¼›è¿˜æœ‰ä¸¤ä¸ª change detection æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº” <code class="language-plaintext highlighter-rouge">[data]="data"</code> <code class="language-plaintext highlighter-rouge">{ { data.name } }</code> å’Œ  <code class="language-plaintext highlighter-rouge">{ { data.address } }</code>ã€‚</p>
  </li>
  <li>
    <p>View_CDParentComponent_Host_0(<strong>internal host component</strong>)ï¼šè´Ÿè´£æ¸²æŸ“å‡ºå®¿ä¸»å…ƒç´  &lt; CDParentComponent &gt; &lt; / CDParentComponent &gt; ï¼Œå¹¶ä¸”ä½¿ç”¨ â€œinternal componentâ€ ç®¡ç†ç»„ä»¶çš„å†…éƒ¨è§†å›¾ï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæ„å»ºæ•´ä¸ªç»„ä»¶æ ‘ã€‚</p>
  </li>
</ul>

<p>å½“ç¼–è¯‘å™¨åˆ†æç»„ä»¶æ¨¡æ¿çš„æ—¶å€™ï¼ŒçŸ¥é“æ¯æ¬¡å˜åŒ–æ£€æµ‹æœ‰å¯èƒ½éœ€è¦æ›´æ–°é¡µé¢ä¸Š DOM å…ƒç´ å±æ€§çš„å€¼ï¼Œå¯¹äºè¿™äº›å±æ€§ï¼Œç¼–è¯‘å™¨éƒ½ä¼šç»™å®ƒåˆ›å»ºç»‘å®šï¼Œç»‘å®šé‡Œè‡³å°‘æœ‰è¿™ä¸ªå±æ€§åç§°å’Œå–å€¼çš„è¡¨è¾¾å¼ã€‚</p>

<p>æœ‰äº† component viewã€ç»‘å®šã€è„æ•°æ®æ£€æŸ¥ï¼Œç»„ä»¶çŠ¶æ€å˜åŒ–å°±å¯ä»¥è§¦å‘å˜åŒ–æ£€æµ‹ä»è€Œæ›´æ–°é¡µé¢ DOM å±æ€§çš„å€¼ã€‚</p>

<h2 id="é‚£ä»€ä¹ˆä¼šè§¦å‘ç»„ä»¶çŠ¶æ€çš„å˜åŒ–">é‚£ä»€ä¹ˆä¼šè§¦å‘ç»„ä»¶çŠ¶æ€çš„å˜åŒ–ï¼Ÿ</h2>

<p>æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨é¡µé¢æŒ‰é’®çš„<code class="language-plaintext highlighter-rouge">click</code>äº‹ä»¶æ›´æ–°<code class="language-plaintext highlighter-rouge">data.name</code>çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">template</span><span class="p">:</span><span class="s2">`&lt;h1&gt;I am &lt;span [textContent]="data.name"&gt;&lt;/span&gt;&lt;h1&gt;
            &lt;button (click)="changeName()"&gt;Change Name&lt;/button&gt;`</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CDParentComponent</span> <span class="p">{</span>
  <span class="nl">data</span> <span class="p">:</span> <span class="kr">any</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span><span class="dl">'</span><span class="s1">meii</span><span class="dl">'</span><span class="p">,</span> <span class="na">address</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ShangHai</span><span class="dl">'</span><span class="p">};</span>
  <span class="nx">changeName</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">limeii</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿˜æœ‰ä¸€ç§å¸¸è§çš„æ–¹å¼æ˜¯ï¼Œé€šè¿‡ http request æ‹¿åˆ° data çš„å€¼ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/contacts</span><span class="dl">'</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
      <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">contacts</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">contacts</span><span class="p">.</span><span class="nx">name</span><span class="p">;);</span>
  <span class="p">}</span>

</code></pre></div></div>

<p><strong><font color="#BF1827">angularé€šå¸¸æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ä¼šå¯¼è‡´ç»„ä»¶æ•°æ®å˜åŒ–ï¼š</font></strong></p>

<ol>
  <li>äº‹ä»¶ï¼šé¡µé¢ clickã€submitã€mouse downâ€¦â€¦</li>
  <li>XHRï¼šä»åç«¯æœåŠ¡å™¨æ‹¿åˆ°æ•°æ®</li>
  <li>Timersï¼šsetTimeout()ã€setInterval()</li>
</ol>

<h2 id="angular-åˆæ€ä¹ˆé€šçŸ¥å„ä¸ªç»„ä»¶åšå˜åŒ–æ£€æµ‹">Angular åˆæ€ä¹ˆé€šçŸ¥å„ä¸ªç»„ä»¶åšå˜åŒ–æ£€æµ‹ï¼Ÿ</h2>

<p>å‰é¢é‚£ä¸‰ç§æ–¹å¼ä¼šå¯¼è‡´ Angular çŠ¶æ€å˜åŒ–ï¼Œé‚£åˆæ˜¯è°çŸ¥é“çŠ¶æ€å·²ç»å‘ç”Ÿæ”¹å˜ï¼Œéœ€è¦é€šçŸ¥ Angular è§¦å‘å˜åŒ–æ£€æµ‹ä»è€Œæ›´æ–°é¡µé¢ DOM å‘¢ï¼Ÿ<code class="language-plaintext highlighter-rouge">NgZoneï¼ˆzone.jsï¼‰</code>å……å½“äº†è¿™ä¸ªè§’è‰²ã€‚</p>

<p>NgZone å¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶æ‹¦æˆªå™¨ï¼Œå®ƒèƒ½å¤Ÿ hook åˆ°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œç„¶åå°±å¯ä»¥æ¥å¤„ç†ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚æ¯ä¸ªå¼‚æ­¥ä»»åŠ¡ callback ä»¥åå°±ä¼šå»é€šçŸ¥ Angular åšå˜åŒ–æ£€æµ‹ã€‚</p>

<p>Angular æºç ä¸­æœ‰ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">ApplicationRef</code>ï¼Œå¯ä»¥ç›‘å¬ NgZones <code class="language-plaintext highlighter-rouge">onTurnDone</code>äº‹ä»¶ï¼Œæ¯å½“<code class="language-plaintext highlighter-rouge">onTurnDone</code>è¢«è§¦å‘åï¼Œå®ƒä¼šç«‹é©¬æ‰§è¡Œ<code class="language-plaintext highlighter-rouge">tick()</code>æ–¹æ³•ï¼Œ<code class="language-plaintext highlighter-rouge">tick()</code>ä¼šä»ä¸Šåˆ°ä¸‹æ²¿ç€ç»„ä»¶æ ‘è§¦å‘å˜åŒ–æ£€æµ‹ã€‚<code class="language-plaintext highlighter-rouge">ApplicationRef</code>ç®€æ´ç‰ˆä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// very simplified version of actual source</span>
<span class="kd">class</span> <span class="nx">ApplicationRef</span> <span class="p">{</span>
  <span class="nl">changeDetectorRefs</span><span class="p">:</span><span class="nx">ChangeDetectorRef</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">zone</span><span class="p">:</span> <span class="nx">NgZone</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">zone</span><span class="p">.</span><span class="nx">onTurnDone</span>
      <span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">zone</span><span class="p">.</span><span class="nx">run</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">tick</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nx">tick</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">changeDetectorRefs</span>
      <span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">ref</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">ref</span><span class="p">.</span><span class="nx">detectChanges</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ¯ä¸ª component éƒ½æœ‰è‡ªå·±çš„å˜åŒ–æ£€æµ‹å™¨ï¼Œè´Ÿè´£æ£€æŸ¥å®ƒä»¬å„è‡ªçš„ç»‘å®šï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>

<p><img src="https://limeii.github.io/assets/images/posts/angular/angular-change-detection05.png" alt="angular-change-detection" height="100%" width="100%" /></p>

<p>æœ‰äº† NgZone ä¸Šè¿°ä¸‰ç§å¼‚æ­¥äº‹ä»¶éƒ½ä¼šå¯¼è‡´æ•´ä¸ª Angular åº”ç”¨å‘ç”Ÿå˜åŒ–æ£€æµ‹ï¼Œè™½ç„¶ Angular å˜åŒ–æ£€æµ‹æœ¬èº«æ€§èƒ½å·²ç»å¾ˆå¥½äº†ï¼Œåœ¨æ¯«ç§’å†…å¯ä»¥åšæˆç™¾ä¸Šåƒæ¬¡å˜åŒ–æ£€æµ‹ã€‚ä½†æ˜¯éšç€é¡¹ç›®è¶Šæ¥è¶Šå¤§ï¼Œå…¶å®å¾ˆå¤šä¸å¿…è¦çš„å˜åŒ–æ£€æµ‹è¿˜æ˜¯ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“æ€§èƒ½ã€‚</p>

<p>åœ¨è¿™ç¯‡æ–‡ç« ã€<a href="https://limeii.github.io/2019/06/angular-changeDetectionStrategy-OnPush/">Angular Change Detection:å˜åŒ–æ£€æµ‹ç­–ç•¥</a>ã€‘ä»‹ç»äº†å¦‚ä½•é€šè¿‡ OnPush æ¥è·³è¿‡ä¸€äº›ä¸å¿…è¦çš„å˜åŒ–æ£€æµ‹ï¼Œä»è€Œä¼˜åŒ–æ•´ä¸ªåº”ç”¨çš„æ€§èƒ½ã€‚</p>
:ET