I"ÜT<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¼šä»‹ç»ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
  <li>
    <p>ä»€ä¹ˆæ˜¯ lazy loading å’Œ preloading</p>
  </li>
  <li>
    <p>å¦‚ä½•åœ¨ angular é¡¹ç›®ä¸­å®ç° lazy loading</p>
  </li>
  <li>
    <p>å¦‚ä½•åœ¨ angular é¡¹ç›®ä¸­å®ç° preloading</p>
  </li>
  <li>
    <p>å¦‚ä½•åœ¨ angular é¡¹ç›®ä¸­ç»“åˆä½¿ç”¨ preloading å’Œ lazy loading</p>
  </li>
</ul>

<h2 id="lazy-loadingå’Œpreloading">lazy loadingå’Œpreloading</h2>

<p>åœ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®æŸä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œè¦ä»æœåŠ¡å™¨ä¸‹è½½ bundle/chunk ç­‰æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶è¿‡å¤§æˆ–è¿‡å¤šï¼Œä¼šå¯¼è‡´ç½‘ç«™å“åº”è¿‡æ…¢ã€‚åœ¨ angular é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡é…ç½® lazy loading å’Œ preloadingæ¥æé«˜æ€§èƒ½ã€‚</p>

<h3 id="lazy-loading">lazy loading</h3>
<p>ç¿»è¯‘åˆ°ä¸­æ–‡å°±æ˜¯æ‡’åŠ è½½ï¼Œå…¶å®å°±æ˜¯æŒ‰éœ€åŠ è½½ã€‚</p>

<p>æœ€å¼€å§‹è®¿é—®æŸä¸€ä¸ªç½‘ç«™ index é¡µé¢çš„æ—¶å€™ï¼Œåªä¸‹è½½è·Ÿ index / æ ¸å¿ƒä»£ç ç›¸å…³çš„ bundle/chunk ç­‰æ–‡ä»¶ã€‚ä¹‹åè·¯ç”±åˆ°æ–°çš„é¡µé¢ï¼Œå†æŒ‰éœ€ä¸‹è½½æ–°é¡µé¢éœ€è¦çš„æ–‡ä»¶ï¼Œå¤§å¤§çš„æé«˜äº†é¦–é¡µè®¿é—®çš„æ€§èƒ½ã€‚</p>

<p>è¿™æ ·å°±é˜²æ­¢åœ¨è®¿é—®å¤§å‹ç½‘ç«™é¦–é¡µçš„æ—¶å€™ï¼Œä¸‹è½½æ–‡ä»¶è¿‡å¤§æˆ–è¿‡å¤šï¼Œå¯¼è‡´ç½‘ç«™é¦–é¡µå“åº”æ—¶é—´è¿‡é•¿ï¼Œé™ä½ç”¨æˆ·ä½“éªŒã€‚</p>

<p>æ¯”å¦‚è®¿é—® index é¦–é¡µçš„æ—¶å€™ï¼Œä¸šåŠ¡æ¨¡å—åªåŠ è½½äº† dashboard ç›¸å…³çš„æ–‡ä»¶ï¼ˆ2.chunk.jsï¼‰ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡» Settings è·¯ç”±åˆ°ç›¸åº”é¡µé¢ï¼Œå†ä¸‹è½½ settings ç›¸å…³çš„æ–‡ä»¶ï¼ˆ0.chunk.jsï¼‰ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡» Report è·¯ç”±åˆ° reports ç›¸åº”é¡µé¢ï¼Œå†ä¸‹è½½ reports ç›¸å…³çš„æ–‡ä»¶ï¼ˆ1.chunk.jsï¼‰ã€‚åŠ¨å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="https://limeii.github.io/assets/images/posts/angular/angular-lazy-loading.gif" alt="angular lazy loading" height="100%" width="100%" /></p>

<h3 id="preloading">preloading</h3>
<p>ç¿»è¯‘åˆ°ä¸­æ–‡æ˜¯é¢„åŠ è½½ï¼Œè¿™ç§æ–¹å¼çš„æ„æ€ï¼Œä¸€æ—¦ç½‘ç«™è¢«è®¿é—®ï¼Œä¼šå»ä¸‹è½½æ‰€æœ‰çš„æ–‡ä»¶ã€‚</p>

<p>ä¸åŒçš„æ˜¯ï¼Œç”¨æˆ·è®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œæœ€å…ˆåŠ è½½ç½‘ç«™æ‰€éœ€è¦çš„åˆå§‹åŒ–çš„æ–‡ä»¶ï¼Œç„¶åå†åå°ä¸‹è½½å…¶ä»– JS æ–‡ä»¶ã€‚</p>

<p>preloading è¿™ç§æ–¹å¼åœ¨ç”¨æˆ·åˆ‡æ¢æ¨¡å—ä¹Ÿå°±æ˜¯è®¿é—®æ–°é¡µé¢ä¹‹å‰å°±æŠŠæ‰€éœ€çš„æ–‡ä»¶ä¸‹è½½å¥½äº†ï¼Œç›¸æ¯” lazy loading æ–¹å¼å¤§å¤§æé«˜äº†é¡µé¢åˆ‡æ¢æ—¶çš„æ€§èƒ½ã€‚</p>

<p>ä½†æ˜¯å¦‚æœç½‘ç«™è¿‡å¤§ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨é¢„åŠ è½½æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä¹Ÿä¼šå¯¼è‡´é¦–é¡µåŠ è½½ä¹‹ååå°ä¸‹è½½è¿‡å¤šä¸å¿…è¦çš„æ–‡ä»¶ã€‚</p>

<p>é¡µé¢åŠ è½½æœ€ä¼˜çš„æ–¹æ¡ˆæ˜¯ï¼Œåˆå§‹åŒ–ç½‘é¡µåŠ è½½çš„æ—¶é—´è¶Šå°‘è¶Šå¥½ï¼Œç„¶åå†æŒ‰éœ€åŠ è½½æ–°é¡µé¢ã€‚ä¹Ÿå°±æ˜¯åˆå§‹åŒ–ï¼ˆæ ¸å¿ƒï¼‰bundle æ–‡ä»¶è¦è¶Šå°è¶Šå¥½ï¼Œå…¶ä»–çš„ä¸šåŠ¡æ¨¡å—åº”è¯¥è¦ç”¨æˆ·ç‚¹äº†å¯¼èˆªä¹‹åå†æŒ‰éœ€åŠ è½½ã€‚</p>

<h2 id="å¦‚ä½•ä¿è¯æ ¸å¿ƒbundleæ–‡ä»¶è¶Šå°è¶Šå¥½">å¦‚ä½•ä¿è¯æ ¸å¿ƒbundleæ–‡ä»¶è¶Šå°è¶Šå¥½</h2>

<h3 id="é€šè¿‡ä»£ç åˆ‡å‰²">é€šè¿‡ä»£ç åˆ‡å‰²</h3>

<p>ä»€ä¹ˆæ˜¯ä»£ç åˆ‡å‰²ï¼Ÿåœ¨ä»£ç æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŠŠæœ€ç»ˆ bundle æ–‡ä»¶ä¸­ï¼Œç‹¬ç«‹çš„æˆ–è€…å…¬ç”¨çš„ä»£ç æŠ½å–å‡ºæ¥ï¼Œæ”¾åœ¨ chunk æ–‡ä»¶ä¸­ï¼Œè¿™å°±æ˜¯ä»£ç åˆ‡å‰²ã€‚æœ‰äº†æŠ½å–å‡ºæ¥çš„ chunk æ–‡ä»¶ï¼Œå°±å¯ä»¥å®ç° lazy loadingäº†ã€‚</p>

<p>æ€ä¹ˆå®ç°ä»£ç åˆ‡å‰²ï¼Ÿä»€ä¹ˆæ—¶å€™åšä»£ç åˆ‡å‰²ï¼Ÿ</p>

<p>å¯ä»¥å‚è€ƒæ–‡ç« ã€<a href="/2018/10/webpack-code-splitting">webpackï¼šä»£ç åˆ‡å‰²</a>ã€‘</p>

<h2 id="å¦‚ä½•åœ¨angularä¸­å®ç°lazy-loading">å¦‚ä½•åœ¨angularä¸­å®ç°lazy loading</h2>
<p>åœ¨ angular ä¸­ï¼Œlazy loading æ˜¯è·Ÿè·¯ç”±ä¸€èµ·å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯åœ¨ä»£ç æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼ŒæŠŠæ¯ä¸ªè·¯ç”±å¯¹åº”çš„æ¨¡å—éƒ½æ‰“åŒ…æˆç‹¬ç«‹çš„ chunk æ–‡ä»¶ï¼Œæœ€ç»ˆå°±å¯ä»¥å®ç°ç”¨æˆ·ç‚¹å‡»å¯¼èˆªåˆ°æ–°é¡µé¢çš„æ—¶å€™æŒ‰éœ€åŠ è½½å¯¹åº”çš„ chunk æ–‡ä»¶ã€‚</p>

<blockquote>
<p>
è¿™ç¯‡æ–‡ç« æ˜¯åŸºäºï¼š
</p>
<p>
angular@5.0.0
</p>
<p>
webpack@3.10.0
</p>
<p>
åœ¨ç”¨ angular cli åˆ›å»ºè¿™ä¸ªé¡¹ç›®ä¹‹åï¼Œå†ç”¨```ne eject```æŠŠ angular å†…ç½®çš„ webpack é…ç½®æ–‡ä»¶å¼¹å‡ºæ¥ï¼Œç„¶åé‡å†™äº† webpack é…ç½®æ–‡ä»¶ã€‚å¦‚æœç”¨ Angular è‡ªå¸¦çš„ç¼–è¯‘æ–¹å¼ï¼ŒAngular Router æœ¬èº«å°±å®ç°äº†lazy loadingã€‚
</p>
</blockquote>

<p>å®Œæ•´ä»£ç å¯ä»¥åœ¨ <a href="https://github.com/LiMeii/angular-seed-project">angular-seed-project</a> ä¸­æŸ¥çœ‹ï¼Œåœ¨æºç ä¸­æŠŠè·¯ç”±ä»£ç å•ç‹¬æå–åˆ° app-routing.module.ts æ–‡ä»¶ä¸­äº†ã€‚</p>

<h3 id="ç¬¬ä¸€æ­¥åœ¨webpackä¸­é…ç½®ä»£ç åˆ‡å‰²">ç¬¬ä¸€æ­¥ï¼Œåœ¨webpackä¸­é…ç½®ä»£ç åˆ‡å‰²</h3>

<p>ä¸ºäº†å®ç°æŒ‰ç…§è·¯ç”±åˆ‡å‰²ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <a href="https://www.npmjs.com/package/angular-router-loader">angular-router-loader</a> æˆ–è€…æ˜¯ <a href="https://www.npmjs.com/package/ng-router-loader">ng-router-loader</a>ã€‚ ä»¥ angular-router-loader ä¸ºä¾‹ï¼Œéœ€è¦åœ¨ webpack config æ–‡ä»¶ä¸­åŠ å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="p">{</span>
        <span class="nl">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">ts$/</span><span class="p">,</span>
        <span class="nx">use</span><span class="p">:</span> <span class="p">[</span>
          <span class="dl">'</span><span class="s1">awesome-typescript-loader</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">angular-router-loader</span><span class="dl">'</span><span class="p">,</span>
          <span class="dl">'</span><span class="s1">angular2-template-loader</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">]</span>
      <span class="p">}</span>
</code></pre></div></div>
<p>ç„¶åå† webpack output ä¸­åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">./build-dev</span><span class="dl">'</span><span class="p">),</span>
    <span class="nx">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">js/[name].bundle.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">chunkFilename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">js/[id].chunk.js</span><span class="dl">'</span>
  <span class="p">},</span>
</code></pre></div></div>
<p>è¿™ç§é…ç½®ï¼Œchunk æœ€åçš„åå­—ä¼šæ˜¯ 0.chunk.jsã€1.chunk.jsã€2.chunk.js â€¦â€¦</p>

<h3 id="ç¬¬äºŒæ­¥é…ç½®è·¯ç”±">ç¬¬äºŒæ­¥ï¼Œé…ç½®è·¯ç”±</h3>
<blockquote>
<p>
æ¯”å¦‚é¡¹ç›®å¯åŠ¨æ¨¡å—æ˜¯ AppModule
</p>
<p>
ä¸šåŠ¡æ¨¡å—åˆ†åˆ«æ˜¯ï¼šDashboardModuleã€SettingsModuleã€ReportsModule
</p>
</blockquote>
<p>å¦‚ä¸‹æ˜¯ ReportsModule çš„ä»£ç ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// reports.module.ts</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">RouterModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/router</span><span class="dl">'</span><span class="p">;</span>

    <span class="c1">// containers</span>
    <span class="k">import</span> <span class="p">{</span> <span class="nx">ReportsComponent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./reports.component</span><span class="dl">'</span><span class="p">;</span>

    <span class="c1">// routes</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTES</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">component</span><span class="p">:</span> <span class="nx">ReportsComponent</span> <span class="p">}];</span>

    <span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forChild</span><span class="p">(</span><span class="nx">ROUTES</span><span class="p">)],</span>
    <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">ReportsComponent</span><span class="p">],</span>
    <span class="p">})</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">ReportsModule</span> <span class="p">{}</span>
</code></pre></div></div>
<p>åœ¨ AppModule ä¸­ï¼ŒåŠ å…¥å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// app.module.ts</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTES</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">reports</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../reports/reports.module#ReportsModule</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">];</span>
</code></pre></div></div>

<p>è¿™å°±å®ç°äº†å½“ url ä¸º /reports çš„æ—¶å€™ï¼Œå°±ä¼šä¸‹è½½ report è¿™ä¸ªæ¨¡å—çš„ä¸šåŠ¡ä»£ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ ReportsModule ä¸­ï¼Œpath æ˜¯ â€˜ â€˜ã€‚</p>

<p>å…¶ä»–æ¨¡å—ä¹Ÿç±»ä¼¼è¿™æ ·å®ç°ï¼Œæœ€å AppModule çš„è·¯ç”±ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTES</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">pathMatch</span><span class="p">:</span> <span class="dl">'</span><span class="s1">full</span><span class="dl">'</span><span class="p">,</span> <span class="na">redirectTo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../dashboard/dashboard.module#DashboardModule</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">settings</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../settings/settings.module#SettingsModule</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">reports</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../reports/reports.module#ReportsModule</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">];</span>
</code></pre></div></div>

<p>è¿™æ ·åœ¨ build ç»“æŸä»¥åï¼Œé™¤äº† bundle æ–‡ä»¶ä»¥å¤–ï¼Œä¼šæœ‰ä¸‰ä¸ª chunk æ–‡ä»¶åˆ†åˆ«æ˜¯ 0.chunk.jsï¼Œ1.chunk.jsï¼Œ2.chunk.jsã€‚è¿™æ ·å°±å®ç°äº†æŒ‰éœ€åŠ è½½ã€‚</p>

<blockquote>
<p>
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ app.module.ts æ–‡ä»¶ä¸­ä¸è¦å†å¼•ç”¨ä¸šåŠ¡ä»£ç æ¨¡å—ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæˆ chunk æ–‡ä»¶
</p>
</blockquote>

<h2 id="å¦‚ä½•åœ¨angularä¸­å®ç°preloading">å¦‚ä½•åœ¨angularä¸­å®ç°preloading</h2>

<p>åœ¨ angular ä¸­ï¼Œ<a href="https://angular.io/api/router/PreloadAllModules">PreloadAllModules</a>è¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”¨æ¥å®ç°é¢„åŠ è½½æ‰€æœ‰çš„æ–‡ä»¶ï¼Œä¸€æ—¦è®¿é—®ç½‘é¡µå°±ä¼šä¸‹è½½æ‰€æœ‰çš„æ–‡ä»¶ã€‚
å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">import</span> <span class="p">{</span> <span class="nx">RouterModule</span><span class="p">,</span> <span class="nx">Routes</span><span class="p">,</span> <span class="nx">PreloadAllModules</span> <span class="p">}</span> <span class="k">from</span> <span class="p">@</span><span class="nd">angular</span><span class="sr">/router</span><span class="err">;
</span>
    <span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTES</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">pathMatch</span><span class="p">:</span> <span class="dl">'</span><span class="s1">full</span><span class="dl">'</span><span class="p">,</span> <span class="na">redirectTo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../dashboard/dashboard.module#DashboardModule</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">settings</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../settings/settings.module#SettingsModule</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">reports</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../reports/reports.module#ReportsModule</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">];</span>

    <span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
    <span class="c1">// ...</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">RouteModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">ROUTES</span><span class="p">,</span> <span class="p">{</span> <span class="na">preloadingStrategy</span><span class="p">:</span> <span class="nx">PreloadAllModules</span> <span class="p">})</span>
    <span class="p">],</span>
    <span class="c1">// ...</span>
    <span class="p">})</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>

</code></pre></div></div>
<p>åœ¨æ–‡ç« æœ€å¼€å§‹å°±æåˆ°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸éœ€è¦æ‰€æœ‰æ–‡ä»¶éƒ½é¢„åŠ è½½ï¼Œè€Œæ˜¯æœ€æ ¸å¿ƒçš„æ–‡ä»¶é¢„åŠ è½½ä»¥åï¼Œåœ¨æŒ‰éœ€åŠ è½½ä¸šåŠ¡æ¨¡å—ä»£ç ã€‚
è¿™å°±è¦æ±‚åœ¨é¡¹ç›®ä¸­ç»“åˆä½¿ç”¨ preloading å’Œ lazy loadingã€‚</p>

<h2 id="å¦‚ä½•åœ¨angularä¸­ç»“åˆä½¿ç”¨preloadingå’Œlazy-loading">å¦‚ä½•åœ¨angularä¸­ç»“åˆä½¿ç”¨preloadingå’Œlazy loading</h2>
<p>angular ä¸­é»˜è®¤åªæœ‰ PreloadAllModules è¿™ä¸ªé€‰æ‹©ï¼Œå¦‚æœéœ€è¦é¢„åŠ è½½ä¸€éƒ¨åˆ†ä»£ç ï¼Œå°±éœ€è¦è‡ªå·±å†™ä»£ç æ¥å®ç°ã€‚</p>

<p>æˆ‘ä»¬å†™ä¸€ä¸ªè‡ªå·±çš„ AppCustomPreloader å¦‚ä¸‹ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">import</span> <span class="p">{</span> <span class="nx">PreloadingStrategy</span><span class="p">,</span> <span class="nx">Route</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/router</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span><span class="p">,</span> <span class="k">of</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">export</span> <span class="kd">class</span> <span class="nx">AppCustomPreloader</span> <span class="k">implements</span> <span class="nx">PreloadingStrategy</span> <span class="p">{</span>
    <span class="nx">preload</span><span class="p">(</span><span class="nx">route</span><span class="p">:</span> <span class="nx">Route</span><span class="p">,</span> <span class="nx">load</span><span class="p">:</span> <span class="nb">Function</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">route</span><span class="p">.</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">route</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">preload</span> <span class="p">?</span> <span class="nx">load</span><span class="p">()</span> <span class="p">:</span> <span class="k">of</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>ç„¶åæŠŠ AppModule æ”¹ä¸ºï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">import</span> <span class="p">{</span> <span class="nx">AppCustomPreloader</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./app-custom-preloader</span><span class="dl">'</span><span class="p">;</span>

    <span class="k">export</span> <span class="kd">const</span> <span class="nx">ROUTES</span><span class="p">:</span> <span class="nx">Routes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span> <span class="na">pathMatch</span><span class="p">:</span> <span class="dl">'</span><span class="s1">full</span><span class="dl">'</span><span class="p">,</span> <span class="na">redirectTo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> 
        <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span><span class="p">,</span> 
        <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../dashboard/dashboard.module#DashboardModule</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:{</span><span class="na">preload</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span> 
    <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">settings</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../settings/settings.module#SettingsModule</span><span class="dl">'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">reports</span><span class="dl">'</span><span class="p">,</span> <span class="na">loadChildren</span><span class="p">:</span> <span class="dl">'</span><span class="s1">../reports/reports.module#ReportsModule</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">];</span>

    <span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
    <span class="c1">// ...</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">RouteModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">ROUTES</span><span class="p">,</span> <span class="p">{</span> <span class="na">preloadingStrategy</span><span class="p">:</span> <span class="nx">AppCustomPreloader</span> <span class="p">})</span>
    <span class="p">],</span>
    <span class="c1">// ...</span>
    <span class="p">})</span>
    <span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>
<p>è¿™å°±è¡¨ç¤º dashboard ä¼šé¢„åŠ è½½ï¼ˆpreloadingï¼‰ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªæ¨¡å—ä¼šæŒ‰éœ€åŠ è½½ï¼ˆlazy loadingï¼‰ã€‚</p>
:ET