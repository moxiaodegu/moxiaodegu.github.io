I"—c<p>åœ¨ RxJS ä¸­æœ‰å››ç§ Subject åˆ†åˆ«æ˜¯ï¼šSubjectï¼ŒBehaviorSubjectï¼ŒAsyncSubjectï¼ŒReplaySubjectï¼›è¿™å››ç§ Subject éƒ½æ˜¯ç‰¹æ®Šçš„ Observableã€‚</p>

<p>åœ¨ä»‹ç»å®ƒä»¬ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™å››ç§ Subject ä¸æ™®é€š Observable çš„åŒºåˆ«ï¼š</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Observable</th>
      <th style="text-align: center">Subject</th>
      <th style="text-align: center">BehaviorSubject</th>
      <th style="text-align: center">AsyncSubject</th>
      <th style="text-align: center">ReplaySubject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Cold</td>
      <td style="text-align: center">Hot</td>
      <td style="text-align: center">Hot</td>
      <td style="text-align: center">Hot</td>
      <td style="text-align: center">Hot</td>
    </tr>
    <tr>
      <td style="text-align: center">æ•°æ®ç”Ÿæˆè€…</td>
      <td style="text-align: center">æ•°æ®ç”Ÿæˆè€…å’Œæ¶ˆè´¹è€…</td>
      <td style="text-align: center">æ•°æ®ç”Ÿæˆè€…å’Œæ¶ˆè´¹è€…</td>
      <td style="text-align: center">æ•°æ®ç”Ÿæˆè€…å’Œæ¶ˆè´¹è€…</td>
      <td style="text-align: center">æ•°æ®ç”Ÿæˆè€…å’Œæ¶ˆè´¹è€…</td>
    </tr>
    <tr>
      <td style="text-align: center">å•æ’­</td>
      <td style="text-align: center">å¤šæ’­</td>
      <td style="text-align: center">å¤šæ’­</td>
      <td style="text-align: center">å¤šæ’­</td>
      <td style="text-align: center">å¤šæ’­</td>
    </tr>
    <tr>
      <td style="text-align: center">æ¯æ¬¡ä»å¤´å¼€å§‹æŠŠå€¼å‘ç»™è§‚å¯Ÿè€…</td>
      <td style="text-align: center">å°†å€¼å¤šæ’­ç»™å·²æ³¨å†Œç›‘å¬è¯¥ Subject çš„è§‚å¯Ÿè€…ä»¬</td>
      <td style="text-align: center">æŠŠæœ€åä¸€ä¸ªå€¼ï¼ˆå½“å‰å€¼ï¼‰å‘é€ç»™è§‚å¯Ÿè€…ï¼ˆéœ€è¦åˆå§‹å€¼ï¼‰</td>
      <td style="text-align: center">æ‰§è¡Œçš„æœ€åä¸€ä¸ªå€¼å‘é€ç»™è§‚å¯Ÿè€…ç›¸å½“äºlast()</td>
      <td style="text-align: center">å¯ä»¥æŠŠä¹‹å‰çš„å€¼å‘é€ç»™è§‚å¯Ÿè€…ï¼ˆé”™è¿‡çš„å€¼ï¼‰</td>
    </tr>
  </tbody>
</table>

<h2 id="cold-vs-hot">Cold vs Hot</h2>

<p>åœ¨æ–‡ç« ã€<a href="https://limeii.github.io/2019/07/rxjs-coldhot-observable/">RxJSï¼šCold vs Hot Observables</a>ã€‘é‡Œè¯¦ç»†ä»‹ç»äº† Cold Observables ä¸ Hot Observables çš„åŒºåˆ«ï¼Œé™¤äº† Observable ä¹‹å¤–ï¼Œè¿™å››ç§ Subject éƒ½æ˜¯ Hot Observablesã€‚</p>

<h2 id="æ•°æ®ç”Ÿäº§è€…-vs-æ•°æ®æ¶ˆè´¹è€…">æ•°æ®ç”Ÿäº§è€… vs æ•°æ®æ¶ˆè´¹è€…</h2>

<ul>
  <li>
    <p><strong>æ•°æ®ç”Ÿäº§è€…</strong>æ˜¯æŒ‡ Observable(å¯è§‚å¯Ÿå¯¹è±¡)ï¼Œäº§ç”Ÿæ•°æ®çš„ä¸€æ–¹ã€‚</p>
  </li>
  <li>
    <p><strong>æ•°æ®æ¶ˆè´¹è€…</strong>æ˜¯æŒ‡ Observers(è§‚å¯Ÿè€…)ï¼Œæ¥æ”¶æ•°æ®çš„ä¸€æ–¹ã€‚</p>
  </li>
</ul>

<p>æ™®é€šçš„ Observable åªæ˜¯æ•°æ®ç”Ÿäº§è€…ï¼Œå‘é€æ•°æ®ã€‚è€Œ Subjectï¼ŒBehaviorSubjectï¼ŒAsyncSubject å’Œ ReplaySubject å³æ˜¯ç”Ÿäº§è€…åˆæ˜¯æ¶ˆè´¹è€…ã€‚æ¯”å¦‚åœ¨ Angularé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨ Subject åœ¨å¤šä¸ª component ä¸­å…±äº«æ•°æ®ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// messageService.ts</span>
<span class="k">private</span> <span class="nx">shareData</span><span class="p">:</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">();</span>

<span class="nx">sendData</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shareData</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">getData</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">shareData</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">();</span>
<span class="p">}</span>

</code></pre></div></div>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// RxjsSubjectBComponent</span>
<span class="c1">// send data from RxjsSubjectBComponent</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">sendData</span><span class="p">(</span><span class="dl">"</span><span class="s2">this message from subject b</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// RxjsSubjectCComponent</span>
<span class="c1">// get data in RxjsSubjectCComponent</span>
<span class="k">this</span><span class="p">.</span><span class="nx">subscription</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></div>
<p>åœ¨è¿™ä¸¤ä¸ª component ä¸­é€šè¿‡å®šä¹‰åœ¨ messageService çš„ Subject å…±äº«æ•°æ®ï¼Œé€šè¿‡ next() æ–¹æ³•ä½¿å¾— Subject æ˜¯æ•°æ®ç”Ÿäº§è€…ï¼ˆå¯è§‚å¯Ÿå¯¹è±¡ï¼‰ï¼Œé€šè¿‡ asObservable() ä½¿å¾— Subject æ˜¯æ•°æ®æ¶ˆè´¹è€…ï¼ˆObserversï¼‰ã€‚</p>

<h2 id="å•æ’­-vs-å¤šæ’­">å•æ’­ vs å¤šæ’­</h2>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¾‹å­ä¸­ï¼Œä¸ä»…æ˜¯åœ¨ component c å¯ä»¥è®¢é˜…æ‹¿åˆ°æ•°æ®ï¼Œåœ¨å…¶ä»– component ä¸­ä¹Ÿå¯ä»¥è®¢é˜…æ‹¿åˆ°æ•°æ®ã€‚æ¯”å¦‚åœ¨ RxjsSubjectAComponent ä¸­å®šä¹‰å¦‚ä¸‹ä»£ç ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// RxjsSubjectAComponent</span>
<span class="c1">// get data in RxjsSubjectAComponent</span>
<span class="k">this</span><span class="p">.</span><span class="nx">subscription</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in componet A and </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">);</span>
    <span class="p">})</span>
</code></pre></div></div>
<p>ä» RxjsSubjectBComponent å‘å‡ºå€¼ï¼Œåœ¨ RxjsSubjectCComponent å’Œ RxjsSubjectAComponent èƒ½æ‹¿åˆ°åŒæ ·çš„å€¼ï¼Œè¿™ä¸ªå°±æ˜¯å¤šæ’­ã€‚</p>

<p>æ™®é€šçš„ Observables æ˜¯ Cold Observables å¹¶ä¸”æ˜¯å•æ’­çš„ï¼Œå…¶ä»–å››ç§ Subject æ˜¯ Hot Observables å¹¶ä¸”æ˜¯å¤šæ’­çš„ã€‚</p>

<p>å•æ’­çš„æ„æ€æ˜¯ï¼Œæ¯ä¸ªæ™®é€šçš„ Observables å®ä¾‹éƒ½åªèƒ½è¢«ä¸€ä¸ªè§‚å¯Ÿè€…è®¢é˜…ï¼Œå½“å®ƒè¢«å…¶ä»–è§‚å¯Ÿè€…è®¢é˜…çš„æ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯æ™®é€š Observables è¢«ä¸åŒçš„è§‚å¯Ÿè€…è®¢é˜…çš„æ—¶å€™ï¼Œä¼šæœ‰å¤šä¸ªå®ä¾‹ï¼Œä¸ç®¡è§‚å¯Ÿè€…æ˜¯ä»ä½•æ—¶å¼€å§‹è®¢é˜…ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æ˜¯ä»å¤´å¼€å§‹æŠŠå€¼å‘ç»™å¯¹åº”çš„è§‚å¯Ÿè€…ã€‚</p>

<h2 id="behaviorsubject">BehaviorSubject</h2>

<p>Subject å…¶ä¸­çš„ä¸€ä¸ªå˜ä½“å°±æ˜¯ BehaviorSubjectï¼Œå®ƒæœ‰ä¸€ä¸ªâ€œå½“å‰å€¼â€çš„æ¦‚å¿µã€‚å®ƒä¿å­˜äº†å‘é€ç»™æ¶ˆè´¹è€…çš„æœ€æ–°å€¼ï¼Œå½“æœ‰æ–°çš„è§‚å¯Ÿè€…è®¢é˜…æ—¶ï¼Œä¼šç«‹å³ä» BehaviorSubject é‚£æ¥æ”¶åˆ°â€œå½“å‰å€¼â€ï¼Œåœ¨å®šä¹‰ä¸€ä¸ª BehaviorSubject æ—¶éœ€è¦æœ‰åˆå§‹å€¼ã€‚</p>

<p>åœ¨ messageService å®šä¹‰ä¸€ä¸ª BehaviorSubjectï¼Œåˆå§‹å€¼æ˜¯1ï¼ŒupdateBehaviorSubject æ–¹æ³•æŠŠå€¼æ›´æ–°ä¸º2ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//messageService.ts</span>
<span class="k">private</span> <span class="nx">behaviorSubject</span><span class="p">:</span> <span class="nx">BehaviorSubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BehaviorSubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">currentBehaviorSubject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">behaviorSubject</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">();</span>
<span class="nx">updateBehaviorSubject</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">behaviorSubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¹¶åœ¨ RxjsSubjectBComponent ä¸­è°ƒç”¨æ‰§è¡Œ updateBehaviorSubject æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//RxjsSubjectBComponent</span>
<span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">updateBehaviorSubject</span><span class="p">();</span>
</code></pre></div></div>
<p>åœ¨ RxjsSubjectAComponent ä¸­è®¢é˜… behaviorSubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">subscription1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">currentBehaviorSubject</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectAComponent and Current behavior subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
    <span class="p">});</span>

<span class="k">this</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription1</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectCComponent ä¸­ï¼Œç­‰5ç§’ä»¥ååœ¨è®¢é˜… behaviorSubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">subscription1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">currentBehaviorSubject</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectCComponent and Current behavior subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
        <span class="p">});</span>

<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>

</code></pre></div></div>

<p>è¿è¡Œæ•ˆæœï¼šåœ¨ RxjsSubjectAComponent ä¸­ä¼šæ‹¿åˆ°1å’Œ2ä¸¤ä¸ªå€¼ï¼Œåœ¨ RxjsSubjectCComponent ä¸­ä¼šæ‹¿åˆ°2è¿™ä¸ªå€¼ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is in RxjsSubjectAComponent and Current behavior subject value is  1
this is in RxjsSubjectAComponent and Current behavior subject value is  2
this is in RxjsSubjectCComponent and Current behavior subject value is  2
</code></pre></div></div>

<p>å¦‚æœæ˜¯æ­£å¸¸çš„ Hot Observable åœ¨5ç§’ä¹‹åï¼Œæ‹¿ä¸åˆ°ä»»ä½•å€¼ï¼Œå› ä¸ºåœ¨äº”ç§’å†…å·²ç»æŠŠå€¼1å’Œ2éƒ½å‘é€å®Œäº†ï¼Œäº”ç§’ä»¥åè§‚å¯Ÿè€…å†è®¢é˜…ï¼Œæ²¡æœ‰ä»»ä½•å€¼å¯ä»¥å‘é€äº†ã€‚ä½†æ˜¯ç”¨ BehaviorSubject ä¿å­˜äº†å‘é€ç»™æ¶ˆè´¹è€…çš„æœ€æ–°å€¼ï¼Œå½“æœ‰æ–°çš„è§‚å¯Ÿè€…è®¢é˜…æ—¶ï¼Œä¼šç«‹å³ä» BehaviorSubject é‚£æ¥æ”¶åˆ°â€œå½“å‰å€¼â€ï¼Œæ‰€ä»¥ RxjsSubjectCComponent çš„è®¢é˜…è€…ä¼šæ‹¿åˆ°2è¿™ä¸ªå€¼ã€‚</p>

<h2 id="replaysubject">ReplaySubject</h2>

<p>ç±»ä¼¼äº BehaviorSubjectï¼Œå¯ä»¥å‘é€æ—§å€¼ç»™æ–°çš„è®¢é˜…è€…ï¼Œä½†æ˜¯ä¸ä»…æ˜¯â€˜å½“å‰å€¼â€™ï¼Œè¿˜å¯ä»¥æ˜¯ä¹‹å‰çš„æ—§å€¼ã€‚</p>

<p>åœ¨ messageService å®šä¹‰ä¸€ä¸ª ReplaySubjectï¼Œä¸ºæ–°çš„è®¢é˜…è€…ç¼“å†²3ä¸ªå€¼ï¼ŒsendReplaySubject æ–¹æ³•æŠŠ1 2 3 4 5äº”ä¸ªå€¼å‘ç»™è®¢é˜…è€…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//messageService.ts</span>
<span class="k">private</span> <span class="nx">replaySubject</span><span class="p">:</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReplaySubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">sendReplaySubject</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">getReplaySubject</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">replaySubject</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">();</span>
<span class="p">}</span>

</code></pre></div></div>

<p>åœ¨ RxjsSubjectBComponent ä¸­ï¼Œè°ƒç”¨ sendReplaySubject æ–¹æ³•ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">sendReplaySubject</span><span class="p">();</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectAComponent ä¸­ï¼Œè®¢é˜… replaySubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">subscription2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getReplaySubject</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectAComponent and Current Replay subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
    <span class="p">});</span>

<span class="k">this</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription2</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectCComponent ä¸­ï¼Œç­‰5ç§’ä»¥ååœ¨è®¢é˜… replaySubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">subscription2</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getReplaySubject</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectCComponent and Current repaly subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription2</span><span class="p">);</span>

<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is in RxjsSubjectAComponent and Current Replay subject value is  1
this is in RxjsSubjectAComponent and Current Replay subject value is  2
this is in RxjsSubjectAComponent and Current Replay subject value is  3
this is in RxjsSubjectAComponent and Current Replay subject value is  4
this is in RxjsSubjectAComponent and Current Replay subject value is  5

this is in RxjsSubjectCComponent and Current repaly subject value is  3
this is in RxjsSubjectCComponent and Current repaly subject value is  4
this is in RxjsSubjectCComponent and Current repaly subject value is  5

</code></pre></div></div>

<h2 id="asyncsubject">AsyncSubject</h2>

<p>åªæœ‰å½“ Observable æ‰§è¡Œå®Œæˆæ—¶(æ‰§è¡Œ complete())ï¼Œå®ƒæ‰ä¼šå°†æ‰§è¡Œçš„æœ€åä¸€ä¸ªå€¼å‘é€ç»™è§‚å¯Ÿè€…ã€‚</p>

<p>åœ¨ messageService å®šä¹‰ä¸€ä¸ª AsyncSubjectï¼ŒsendAsyncSubject æ–¹æ³•æŠŠ10001 10002 10003 ä¸‰ä¸ªå€¼å‘ç»™è®¢é˜…è€…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="nx">asyncSubject</span><span class="p">:</span> <span class="nx">AsyncSubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncSubject</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">();</span>

<span class="nx">sendAsyncSubject</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">asyncSubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">10001</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">asyncSubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">10002</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">asyncSubject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">10003</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">asyncSubject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">getAsyncSubject</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">asyncSubject</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectBComponent ä¸­ï¼Œè°ƒç”¨ sendAsyncSubject æ–¹æ³•ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">sendAsyncSubject</span><span class="p">();</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectAComponent ä¸­ï¼Œè®¢é˜… asyncSubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">subscription3</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getAsyncSubject</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectAComponent and Current Async subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
    <span class="p">});</span>

<span class="k">this</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription3</span><span class="p">);</span>
</code></pre></div></div>

<p>åœ¨ RxjsSubjectCComponent ä¸­ï¼Œç­‰5ç§’ä»¥ååœ¨è®¢é˜… asyncSubject çš„å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">subscription3</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messageService</span><span class="p">.</span><span class="nx">getAsyncSubject</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">this is in RxjsSubjectCComponent and Current async subject value is  </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">subscription3</span><span class="p">);</span>

<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</code></pre></div></div>

<p>æ•ˆæœå¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this is in RxjsSubjectAComponent and Current Async subject value is  10003
this is in RxjsSubjectCComponent and Current async subject value is  10003
</code></pre></div></div>
:ET